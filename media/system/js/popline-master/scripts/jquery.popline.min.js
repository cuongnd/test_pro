(function(a){function n(){var b=a.a.current.target,c=a.a.current.b;return{fixed:{s:function(b){var d=a.a.c.selection().l().getBoundingClientRect();b=b.pageX-c.width()/2;var g=document.body.scrollTop||document.documentElement.scrollTop;0>b&&(b=10);d=g+d.top-c.outerHeight()-10;return{left:b,top:d}},C:function(){var b=null,d=null,d=a.a.J(),g=a.a.current.P();if(1===g||2===g)b=d.right-c.width()/2;else if(-1===g||-2===g)b=d.left-c.width()/2;d=(document.body.scrollTop||document.documentElement.scrollTop)+
d.top-c.outerHeight()-10;return{left:b,top:d}}},relative:{s:function(a){var d=a.pageX-c.width()/2;0>d&&(d=10);a=a.pageY-c.outerHeight()-parseInt(b.h("font-size"))/2;return{left:d,top:a}},C:function(){var f=null,d=null,g=a.a.J(),k=a.a.current.P();if(1===k||2===k)f=g.right-c.width()/2,d=a(document).scrollTop()+g.bottom-c.outerHeight()-parseInt(b.h("font-size"));else if(-1===k||-2===k)f=g.left-c.width()/2,d=a(document).scrollTop()+g.top-c.outerHeight();return{left:f,top:d}}}}[a.a.current.g.position]}
function p(b){if(!a.a.c.j(a.a.current))if(0<a.a.c.selection().text().length&&!a.a.current.o()){var c=a.a.current.b;if(c.is(":hidden")||c.is(":animated"))c.stop(!0,!0),b=n().s(b),a.a.current.show(b)}else a.a.L()}var m=!1;a(document).D("compositionstart",function(){m=!0});a(document).D("compositionend",function(){m=!1});var q={$:function(){a.a.current=a(this).data("popline");a.a.L()},C:function(b){var c=a(this).data("popline");!m&&0<a.a.c.selection().text().length&&!c.o()?(b=n().C(b),a.a.current.show(b)):
a.a.current.i()},na:function(){a.a.current=a(this).data("popline");var b=a.a.c.selection().text();a.a.c.j(b)||""===a.trim(b)||0<a.a.c.selection().l().getClientRects().length&&a(this).data("lastKeyPos",a.a.m())}};a.la.a=function(b){a.a.c.f.Y()||(_arguments=arguments,this.ha(function(){if(1<=_arguments.length&&"string"===typeof _arguments[0]&&a(this).data("popline")){var c=a(this).data("popline")[_arguments[0]];"function"===typeof c&&c.apply(a(this).data("popline"),Array.prototype.slice.call(_arguments,
1))}else a(this).data("popline")||new a.a(b,this)}),a(document).data("popline-global-binded")||(a(document).s(function(a){var b=this;setTimeout(function(){p.call(b,a)},1)}),a(document).data("popline-global-binded",!0)))};a.a=function(b,c){this.g=a.extend(!0,{},a.a.I,b);this.setPosition(this.g.position);this.target=a(c);this.Z();a.a.R(this)};a.extend(a.a,{I:{zIndex:9999,mode:"edit",enable:null,disable:null,position:"fixed",o:!0},B:[],current:null,prototype:{Z:function(){function b(g,k){for(var l in k){var h=
k[l];if((a.a.c.j(h.mode)?a.a.I.mode:h.mode)===d.g.mode&&f(this.g.enable,l)&&!c(this.g.disable,l)){var e=a("<li><span class='popline-btn'></span></li>");e.G("popline-button popline-"+l+"-button");h.X&&e.children(".popline-btn").append("<a class='"+h.X+"' href='javascript:void(0);'></a>");h.text&&e.children(".popline-btn").append("<a href='javascript:void(0);'><span class='popline-text popline-background-fix'>"+h.text+"</span></a>");h.bgColor&&(e.h({"background-color":h.bgColor}),e.find("span.popline-text").F("popline-background-fix"));
a.O(h.U)&&this.v.push({name:l,w:h.U});a.O(h.S)&&this.u.push({name:l,w:h.S});e.T(g);h.buttons?($subbar=a("<ul class='popline-subbar'></ul>"),e.append($subbar),b.call(this,$subbar,h.buttons),e.click(function(b){var c=this;a(this).K("popline-boxed")||(d.da(a(this),function(){a(c).pa("li").i().end().children(".popline-btn").i().end().children("ul").show().end()}),b.stopPropagation())})):a.O(h.action)&&e.click(function(a){return function(b){a.action.call(this,b,d)}}(h));e.$(function(b){a(b.target).is("input")||
b.preventDefault()});e.s(function(a){a.stopPropagation()})}}}function c(b,d){if(null===b)return!1;for(var f=0,h=b.length;f<h;f++){var e=b[f];if("string"===typeof e&&d===e||a.isArray(e)&&((1===e.length||!a.isArray(e[1]))&&c(e,d)||c(e.slice(1),d)))return!0}return!1}function f(b,c){if(null===b)return!0;for(var d=0,h=b.length;d<h;d++){var e=b[d];if("string"===typeof e&&c===e||a.isArray(e)&&f(e,c))return!0}return!1}this.b=a("<ul class='popline' style='z-index:"+this.g.zIndex+"'></ul>").T("body");this.b.data("popline",
this);this.target.data("popline",this);var d=this;b.call(this,this.b,a.a.buttons);this.b.D("mouseenter","li",function(b){a(this).K("popline-boxed")||a(this).G("popline-hover");b.stopPropagation()});this.b.D("mouseleave","li",function(b){a(this).K("popline-boxed")||a(this).F("popline-hover");b.stopPropagation()})},show:function(b){for(var c=0,f=this.v.length;c<f;c++){var d=this.v[c],g=this.b.find("li.popline-"+d.name+"-button");d.w.call(g,this)}this.b.h("top",b.top+"px").h("left",b.left+"px").stop(!0,
!0).ia();a.a.c.f.M()&&a.a.c.W()},i:function(){var b=this;this.b.is(":visible")&&!this.b.is(":animated")&&this.b.ja(function(){b.b.find("li").F("popline-boxed").show();b.b.find(".popline-subbar").i();b.b.find(".popline-textfield").i();b.b.find(".popline-btn").show();for(var a=0,f=b.u.length;a<f;a++){var d=b.u[a],g=b.b.find("li.popline-"+d.name+"-button");d.w.call(g,b)}})},ga:function(){this.target.qa(q);this.target.ba("popline");this.target.ba("lastKeyPos");this.b.remove()},da:function(b,a,f){if("function"===
typeof a){var d=this,g=parseInt(d.b.h("left"))+d.b.width()/2;d.b.H({opacity:0,marginTop:-d.b.height()+"px"},function(){a.call(this);b.F("popline-hover").G("popline-boxed").show();d.b.h("margin-top",d.b.height()+"px");d.b.h("left",g-d.b.width()/2+"px");"function"===typeof f?d.b.H({opacity:1,marginTop:0},f):d.b.H({opacity:1,marginTop:0})})}},o:function(){return this.g.o&&""===a.trim(a.a.c.selection().text())?!0:!1},P:function(){var b=this.target.data("lastKeyPos");currentRect=a.a.m();return a.a.c.j(b)?
null:currentRect.top===b.top&&currentRect.bottom!==b.bottom?1:currentRect.bottom===b.bottom&&currentRect.top!==b.top?-1:currentRect.right!==b.right?2:currentRect.left!==b.left?-2:0},setPosition:function(a){this.g.position="relative"===a?"relative":"fixed"},v:[],u:[]},L:function(){for(var b=0,c=a.a.B.length;b<c;b++)a.a.B[b].i()},R:function(b){a.a.B.push(b)},m:function(b){a.a.c.j(b)&&(b=a.a.c.selection().l().getClientRects());return{top:parseInt(b[0].top),left:parseInt(b[0].left),right:parseInt(b[b.length-
1].right),bottom:parseInt(b[b.length-1].bottom)}},ea:function(){for(var b=a.a.c.selection().l().getClientRects(),c=[],f=0,d=b.length;f<d;f++){var g=b[f];0!==g.width&&(0!==f&&f!==b.length-1||1!==g.width)&&c.push(g)}return a.a.m(c)},J:function(){if(a.a.c.f.V||a.a.c.f.opera||a.a.c.f.A)return a.a.m();if(a.a.c.f.chrome||a.a.c.f.ca)return a.a.ea()},c:{j:function(a){return"undefined"===typeof a||null===a?!0:!1},oa:function(){return Math.floor(1E7*Math.random()+1)},trim:function(a){return a.replace(/^\s+|\s+$/g,
"")},f:{chrome:navigator.userAgent.match(/chrome/i)?!0:!1,ca:navigator.userAgent.match(/safari/i)&&!navigator.userAgent.match(/chrome/i)?!0:!1,V:navigator.userAgent.match(/firefox/i)?!0:!1,opera:navigator.userAgent.match(/opera/i)?!0:!1,A:navigator.userAgent.match(/msie|trident\/.*rv:/i)?!0:!1,ra:navigator.userAgent.match(/webkit/i)?!0:!1,N:function(){var a=-1;null!==/(MSIE |rv:)([0-9]{1,}[.0-9]{0,})/.exec(navigator.userAgent)&&(a=parseFloat(RegExp.$2));return a},Y:function(){return a.a.c.f.A&&8>
a.a.c.f.N()},M:function(){return a.a.c.f.A&&9>a.a.c.f.N()}},ka:function(b,c){for(a.isArray(c)||(c=[c]);b;){if(3!==b.nodeType&&-1!==a.ma(b.tagName,c))return b;b=b.parentNode}return null},selection:function(){return a.a.c.f.M()?{aa:function(){return document.selection},l:function(){return document.selection.createRange()},text:function(){return document.selection.createRange().text},focusNode:function(){return document.selection.createRange().parentElement()},select:function(a){a.select()},empty:function(){document.selection.empty()}}:
{aa:function(){return window.getSelection()},l:function(){return window.getSelection().getRangeAt(0)},text:function(){return window.getSelection().toString()},focusNode:function(){return window.getSelection().focusNode},select:function(a){window.getSelection().addRange(a)},empty:function(){window.getSelection().removeAllRanges()}}},W:function(){var a=document.getElementsByTagName("head")[0],c=document.createElement("style");c.type="text/css";c.styleSheet.cssText=":before,:after{content:none !important";
a.appendChild(c);setTimeout(function(){a.removeChild(c)},0)}},fa:function(b){a.extend(a.a.buttons,b)},buttons:{}})})(jQuery); 
