<?phpdefined('_JEXEC') or die('Restricted access');JToolBarHelper::back();JHtml::_('behavior.formvalidation');JToolBarHelper::title(JText::_('COM_BOOKPRO_ADD_RATE_MANAGER'), 'object');$orderDir = $this->lists['order_Dir'];$order = $this->lists['order'];$itemsCount = count($this->items);$pagination = &$this->pagination;$doc = JFactory::getDocument();$doc->addScript(JUri::root() . '/administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/dhtmlxscheduler.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_recurring.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_minical.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_year_view.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_agenda_view.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_grid_view.js');$doc->addScript(JUri::root() . 'administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/ext/dhtmlxscheduler_tooltip.js');$doc->addStyleSheet(JUri::root() . '/administrator/components/com_bookpro/classes/dhtmlxScheduler_v4.1.0/codebase/dhtmlxscheduler.css');?><script type="text/javascript">    function show_minical() {        if (scheduler.isCalendarVisible())            scheduler.destroyCalendar();        else            scheduler.renderCalendar({                position: "dhx_minical_icon",                date: scheduler._date,                navigation: true,                handler: function (date, calendar) {                    scheduler.setCurrentView(date);                    scheduler.destroyCalendar()                }            });    }</script><form action="index.php" method="post" name="adminForm" class="form-validate">    <div class="row-fluid"><h2><?php echo $this->bustrip->dest_from_title.' to '.$this->bustrip->dest_to_title ?></h2></div>    <div id="scheduler_here" class="dhx_cal_container" style='width:1300px; height:800px;'>        <div class="dhx_cal_navline">            <div class="dhx_cal_prev_button">&nbsp;</div>            <div class="dhx_cal_next_button">&nbsp;</div>            <div class="dhx_cal_today_button"></div>            <div class="dhx_cal_date"></div>            <div class="dhx_minical_icon" id="dhx_minical_icon" onclick="show_minical()">&nbsp;</div>            <div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div>            <div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div>            <div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>            <div class="dhx_cal_tab" name="agenda_tab" style="right:280px;"></div>            <div class="dhx_cal_tab" name="year_tab" style="right:280px;"></div>            <div class="dhx_cal_tab" name="grid_tab" style="right:300px;"></div>        </div>        <div class="dhx_cal_header">        </div>        <div class="dhx_cal_data">        </div>    </div>    <input type="hidden" name="option" value="<?php echo OPTION; ?>"/>    <input type="hidden" name="controller" value="busrate"/>    <input type="hidden" name="task" value="save"/>    <input type="hidden" name="boxchecked" value="1"/>    <input type="hidden" name="cid[]" value="<?php echo $this->obj->id; ?>" id="cid"/>    <?php echo JHTML::_('form.token'); ?></form><div id="my_form">    <label for="description">Event text </label><input type="text" name="description" value="" id="description"><br>    <label for="custom1">Custom 1 </label><input type="text" name="custom1" value="" id="custom1"><br>    <label for="custom2">Custom 2 </label><input type="text" name="custom2" value="" id="custom2"><br><br>    <input type="button" name="save" value="Save" id="save" style='width:100px;' onclick="save_form()">    <input type="button" name="close" value="Close" id="close" style='width:100px;' onclick="close_form()">    <input type="button" name="delete" value="Delete" id="delete" style='width:100px;' onclick="delete_event()"></div><script type="text/javascript" charset="utf-8">    bustrip_id=<?php echo JRequest::getVar('bustrip_id') ?>;    scheduler.config.js_bustrip_id=bustrip_id;    scheduler.config.multi_day = true;    scheduler.config.event_duration = 35;    scheduler.config.xml_date = "%Y-%m-%d %H:%i";    scheduler.config.occurrence_timestamp_in_utc = true;    scheduler.config.include_end_by = true;    scheduler.config.repeat_precise = true;    scheduler.locale.labels.agenda_tab = "My Agenda";    //'grid_tab' is the name of our div    scheduler.locale.labels.grid_tab = "Grid";    //to display dates from 1st June 2013    scheduler.config.agenda_start = new Date();    //to display dates until 1st June,2014    scheduler.config.agenda_end = new Date();    scheduler.templates.event_bar_text = function(start,end,ev){        return ev.text+' $';    };    scheduler.templates.quick_info_content = function(start, end, ev){        return ev.text+'$';    };    scheduler.templates.agenda_text = function(start,end,ev){        return ev.text+'$';    };    scheduler.templates.event_text = function(start,end,ev){        return ev.text+' $';    };    var format=scheduler.date.date_to_str("%Y-%m-%d %H:%i");    scheduler.templates.tooltip_text = function(start,end,event) {        return "<b>Price:</b> "+event.text+"$<br/><b>Start date:</b> "+        format(start)+"<br/><b>End date:</b> "+format(end);    };    scheduler.attachEvent("onLightbox", function () {        var lightbox_form = scheduler.getLightbox(); // this will generate lightbox form        var inputs = lightbox_form.getElementsByTagName('input');        var date_of_end = null;        for (var i = 0; i < inputs.length; i++) {            if (inputs[i].name == "date_of_end") {                date_of_end = inputs[i];                break;            }        }        var repeat_end_date_format = scheduler.date.date_to_str(scheduler.config.repeat_date);    });    scheduler.createGridView({        name:"grid",        fields:[    // defines columns of the grid            {id:"id",   label:'Id',   sort:'int',  width:80,  align:'right'},            {id:"date", label:'Date', sort:'date', width:'*'},            {id:"text", label:'Price', sort:'str',  width:200, align:'left'}        ],        from:new Date(),//left border of the allowable date range        to:new Date(9999,1,1)    //right border of the allowable date range    });    scheduler.load("index.php?option=com_bookpro&controller=busrate&task=loadData&bustrip_id="+bustrip_id,"json");    var dp = new dataProcessor("index.php?option=com_bookpro&controller=busrate&task=saveData&bustrip_id="+bustrip_id);    dp.init(scheduler);    //dp.setUpdateMode("off");    scheduler.attachEvent("onEventAdded", function(event_id,event_object){        dp.sendData();    });    scheduler.form_blocks["my_editor"]={        render:function(sns){            return "<div class='dhx_cal_ltext' style='height:60px;'>Price&nbsp;<input type='number'>$</div>";        },        set_value:function(node,value,ev){            node.childNodes[1].value=value||"";        },        get_value:function(node,ev){            return node.childNodes[1].value;        },        focus:function(node){            var a=node.childNodes[1]; a.select(); a.focus();        }    }    scheduler.form_blocks["bustrip"]={        render:function(sns){            return "<div class='dhx_cal_ltext' style='height:60px;'>Bustrip&nbsp;<input type='text' readonly><br/>Bustrip:<span></span></div>";        },        set_value:function(node,value,ev){            node.childNodes[1].value=bustrip_id;            console.log(node.childNodes[4]);            node.childNodes[4].innerHTML='<?php echo $this->bustrip->dest_from_title.' to '.$this->bustrip->dest_to_title ?>';        },        get_value:function(node,ev){            return node.childNodes[1].value;        },        focus:function(node){            var a=node.childNodes[1]; a.select(); a.focus();        }    }    scheduler.config.lightbox.sections = [        { name:"Bustrip", height:200, map_to:"bustrip_id", type:"bustrip" , focus:false},        { name:"Add Price", height:200, map_to:"text", type:"my_editor" , focus:true},        {name: "recurring", type: "recurring", map_to: "rec_type", button: "recurring"},        {name: "time", height: 72, type: "calendar_time", map_to: "auto"}    ];    scheduler.init('scheduler_here', new Date(), "month");</script><style type="text/css">    .dhx_cal_light label {        display: inline;    }    #my_form {        position: absolute;        top: 100px;        left: 200px;        z-index: 10001;        display: none;        background-color: white;        border: 2px outset gray;        padding: 20px;        font-family: Tahoma;        font-size: 10pt;    }    #my_form label {        width: 200px;    }</style>